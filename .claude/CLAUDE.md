# CLAUDE.md - æš¦ KOYOMI é–‹ç™ºæ†²æ³•ï¼ˆæœ€é©åŒ–ç‰ˆï¼‰

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.0  
**æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ12æ—¥

---

## ğŸ§  åŸºæœ¬å§¿å‹¢

ã‚ãªãŸã¯ã€Œæš¦ KOYOMIã€ã®å°‚å±é–‹ç™ºã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æœ¬è³ª**:
- Aï¼‰è·äººèŠ¸ï¼ˆå››æŸ±æ¨å‘½ï¼‰ã‚’AIã«ä¿å­˜ â† Zone 0
- Bï¼‰æ„æ€æ±ºå®šæ”¯æ´SaaS â† Zone 1-2
- Cï¼‰çµŒå–¶è€…å‘ã‘ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ â† Zone 2B-3

**é–‹ç™ºå“²å­¦**:
- å°‚é–€çŸ¥è­˜ã®æ­£ç¢ºæ€§ > é–‹ç™ºé€Ÿåº¦
- ä¿¡é ¼æ€§ > æ©Ÿèƒ½ã®è±Šå¯Œã•
- æ®µéšçš„æ”¹å–„ > ä¸€æ°—ã«å®Œç’§

---

## ğŸš¦ Zoneåˆ¥åˆ¶å¾¡ãƒ«ãƒ¼ãƒ«ï¼ˆ4å±¤ + ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰ï¼‰

### â„ï¸ **Zone 0: å‡çµã‚³ã‚¢ï¼ˆFrozen Coreï¼‰**

**å¯¾è±¡**:
```
src/koyomi/layer1/engine.py        # å››æŸ±æ¨å‘½è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³
src/koyomi/layer1/taizan_db.json   # æ³°å±±æµãƒ‡ãƒ¼ã‚¿ï¼ˆ120é€šã‚Šï¼‰
src/koyomi/layer1/metaphor.py      # ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼è¾æ›¸ï¼ˆ120é€šã‚Šï¼‰
```

**ãƒ«ãƒ¼ãƒ«**:
- â›” **åŸå‰‡ä¿®æ­£ç¦æ­¢ï¼ˆRead-Onlyï¼‰**
- ğŸ”’ ä¿®æ­£ã¯ã€Œç›£æŸ»ãƒ¢ãƒ¼ãƒ‰ã€ã§ã®ã¿è¨±å¯
- ğŸ“– å‚ç…§ãƒ»èª­ã¿è¾¼ã¿ã¯è‡ªç”±

**ä¿®æ­£ãŒå¿…è¦ãªå ´åˆ**:
```markdown
âš ï¸ è­¦å‘Š: Zone 0 ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å°‚é–€çŸ¥è­˜ã®æ ¸å¿ƒéƒ¨åˆ†ã§ã™ã€‚
ä¿®æ­£ã¯ã€Œç›£æŸ»ãƒ¢ãƒ¼ãƒ‰ã€ã§ã®ã¿è¨±å¯ã•ã‚Œã¾ã™ã€‚

é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã§ä¿®æ­£ãŒå¿…è¦ãªå ´åˆï¼š
1. ãƒã‚°ã§ã‚ã‚‹è¨¼æ‹ ã‚’æç¤º
2. å°‚é–€å®¶ã®ç›£ä¿®ã‚’æ¨å¥¨
3. å®Œå…¨ãªãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ˜ç¤ºçš„ãªè¨±å¯

ãã‚Œã§ã‚‚ä¿®æ­£ã—ã¾ã™ã‹ï¼Ÿ (yes/no)
```

---

### ğŸ”´ **Zone 1: å³æ ¼åˆ¶å¾¡ï¼ˆStrict Controlï¼‰**

**å¯¾è±¡**:
```
src/koyomi/chat/analyzer.py        # çµ±åˆåˆ†æã‚¨ãƒ³ã‚¸ãƒ³
src/koyomi/chat/consultant.py      # Claude APIçµ±åˆ
tests/unit/test_layer1.py          # ã‚³ã‚¢ãƒ†ã‚¹ãƒˆ
```

**ãƒ«ãƒ¼ãƒ«**:
1. **Plan Mode å¿…é ˆ**: `/plan` ã§è¨ˆç”»æç¤º
2. **å½±éŸ¿ç¯„å›²åˆ†æ**: Zone 0ã¸ã®å½±éŸ¿ã‚’å¿…ãšç¢ºèª
3. **ãƒ†ã‚¹ãƒˆå¿…é ˆ**: ä¿®æ­£å¾Œã€è©²å½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
4. **1ãƒ•ã‚¡ã‚¤ãƒ«ãšã¤**: è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«åŒæ™‚ä¿®æ­£ç¦æ­¢
5. **æ‰¿èªå¾Œå®Ÿè£…**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªã‚’å¾—ã¦ã‹ã‚‰

**è¨ˆç”»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
```markdown
## ä¿®æ­£è¨ˆç”»ï¼ˆZone 1ï¼‰

### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `src/koyomi/chat/analyzer.py`

### ä¿®æ­£å†…å®¹
1. ç›¸æ€§è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã«è£œå®Œé–¢ä¿‚åˆ¤å®šã‚’è¿½åŠ 
2. ã‚¹ã‚³ã‚¢è¨ˆç®—å¼ã‚’æ”¹å–„ï¼ˆ50ç‚¹åŸºæº– â†’ è©³ç´°åŒ–ï¼‰

### Zone 0ã¸ã®å½±éŸ¿
- âœ… ãªã—ï¼ˆLayer1ã‚¨ãƒ³ã‚¸ãƒ³ã¯ä½¿ç”¨ã™ã‚‹ã®ã¿ï¼‰

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
- `pytest tests/unit/test_analyzer.py`
- æ–°è¦ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3ã¤è¿½åŠ 

### ãƒªã‚¹ã‚¯
- æ—¢å­˜ã®ç›¸æ€§è¨ˆç®—çµæœãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®èª¬æ˜ãŒå¿…è¦

æ‰¿èªã„ãŸã ã‘ã‚Œã°å®Ÿè£…ã—ã¾ã™ã€‚
```

---

### ğŸŸ¡ **Zone 2A: åˆ¶å¾¡ä»˜ãæŸ”è»Ÿæ€§ï¼ˆControlled Flexibilityï¼‰**

**å¯¾è±¡**:
```
src/koyomi/chat/hearing.py         # ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
app.py (ãƒ­ã‚¸ãƒƒã‚¯éƒ¨åˆ†)              # ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
```

**ãƒ«ãƒ¼ãƒ«**:
1. **ç°¡æ˜“Plan**: ç®‡æ¡æ›¸ãã§å¤‰æ›´å†…å®¹æç¤º
2. **å½±éŸ¿ç¢ºèª**: Zone 0-1ã¸ã®å½±éŸ¿ãƒã‚§ãƒƒã‚¯
3. **ãƒ†ã‚¹ãƒˆæ¨å¥¨**: å¯èƒ½ãªã‚‰å®Ÿè¡Œ
4. **æ‰¿èªå¾Œå®Ÿè£…**: æ‰¿èªã‚’å¾—ã¦ã‹ã‚‰

**ç°¡æ˜“è¨ˆç”»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
```markdown
## å¤‰æ›´å†…å®¹ï¼ˆZone 2Aï¼‰

å¯¾è±¡: `src/koyomi/chat/hearing.py`

å¤‰æ›´:
- ãƒ’ã‚¢ãƒªãƒ³ã‚°è³ªå•ã‚’3ã¤è¿½åŠ 
- è³ªå•ã®é †åºã‚’æœ€é©åŒ–

å½±éŸ¿:
- Zone 0-1: ãªã—
- UI: è³ªå•ã®è¡¨ç¤ºé †ãŒå¤‰ã‚ã‚‹

ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ
```

---

### ğŸŸ¢ **Zone 2B: æº–è‡ªç”±ï¼ˆSemi-Freeï¼‰**

**å¯¾è±¡**:
```
src/koyomi/chat/consultant.py      # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®šç¾©éƒ¨åˆ†
app.py (UIæ–‡è¨€)                    # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€èª¬æ˜æ–‡
```

**ãƒ«ãƒ¼ãƒ«**:
1. **ç›´æ¥ä¿®æ­£OK**: Planä¸è¦
2. **äº‹å¾Œå ±å‘Š**: ä½•ã‚’å¤‰ãˆãŸã‹å ±å‘Š
3. **Git Commit**: å¿…ãšå®Ÿè¡Œ

**å ±å‘Šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
```markdown
âœ… ä¿®æ­£å®Œäº†ï¼ˆZone 2Bï¼‰

ãƒ•ã‚¡ã‚¤ãƒ«: `src/koyomi/chat/consultant.py`
å¤‰æ›´: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ–‡è¨€ã‚’æ”¹å–„
ç†ç”±: ã‚ˆã‚Šå…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚
```

---

### ğŸŸ¢ **Zone 3: è‡ªç”±ï¼ˆFree Zoneï¼‰**

**å¯¾è±¡**:
```
docs/**                            # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
static/css/**                      # ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ
README.md                          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
```

**ãƒ«ãƒ¼ãƒ«**:
1. **å³æ™‚å®Ÿè¡Œ**: å ±å‘Šä¸è¦
2. **è‡ªç”±ã«å®Ÿé¨“**: è©¦è¡ŒéŒ¯èª¤OK
3. **Git Commit**: å¿˜ã‚Œãšã«

---

## ğŸ”„ ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰ï¼ˆAudit Modeï¼‰

### ç™ºå‹•æ¡ä»¶

ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®å ´åˆã«ç™ºå‹•ï¼š

1. **å¹´æ¬¡ç›£æŸ»**: æ¯å¹´1å›ï¼ˆæ¨å¥¨: 1æœˆï¼‰
2. **å¤§å‹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ**: ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—å‰
3. **é‡å¤§ãƒã‚°ç™ºè¦‹**: Zone 0ã«èµ·å› ã™ã‚‹ãƒã‚°
4. **å°‚é–€å®¶ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å››æŸ±æ¨å‘½å°‚é–€å®¶ã®æŒ‡æ‘˜

### ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰ã®æ‰‹é †

```markdown
ã€ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ã€‘

1. äº‹å‰æº–å‚™
   - å…¨ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèª
   - Git ã§å°‚ç”¨ãƒ–ãƒ©ãƒ³ãƒä½œæˆï¼ˆaudit-2026-01ï¼‰
   - å¤‰æ›´å‰ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜

2. Zone 0ã®ä¿®æ­£è¨±å¯
   - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°OK
   - ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„OK
   - ãƒ‡ãƒ¼ã‚¿æ§‹é€ å¤‰æ›´OK

3. å³æ ¼ãªæ¤œè¨¼
   - å®Œå…¨ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ï¼ˆ100%ï¼‰
   - å°‚é–€å®¶ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¨å¥¨
   - æ—¢å­˜ã®é‘‘å®šçµæœã¨ã®æ•´åˆæ€§ç¢ºèª

4. æ®µéšçš„ãƒãƒ¼ã‚¸
   - å°ã•ãªå¤‰æ›´ã”ã¨ã«commit
   - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’æŒŸã‚€
   - å•é¡ŒãŒã‚ã‚Œã°å³åº§ã«revert

5. ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰çµ‚äº†
   - å…¨ãƒ†ã‚¹ãƒˆé€šéç¢ºèª
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
   - å¤‰æ›´ãƒ­ã‚°ä½œæˆ

ã€ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰çµ‚äº†ã€‘
```

---

## ğŸ¤– è‡ªå‹•åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆ3å±¤æ¤œè¨¼ï¼‰

äººé–“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è² è·ã‚’ä¸‹ã’ã‚‹ãŸã‚ã€3å±¤ã§è‡ªå‹•ãƒã‚§ãƒƒã‚¯ï¼š

### Layer 1: æ©Ÿæ¢°çš„ãƒã‚§ãƒƒã‚¯ï¼ˆCI/CDï¼‰

```yaml
# .github/workflows/zone-check.yml
on: [push, pull_request]

jobs:
  zone-protection:
    runs-on: ubuntu-latest
    steps:
      - name: Zone 0 ä¿è­·
        run: |
          # Zone 0ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
          git diff --name-only origin/main | grep -E "^src/koyomi/layer1/" && exit 1 || exit 0
      
      - name: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        run: pytest tests/
      
      - name: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯
        run: pytest --cov=src/koyomi --cov-fail-under=80
```

### Layer 2: Claudeè‡ªå·±æ¤œè¨¼

ä¿®æ­£å‰ã«è‡ªå‹•ã§å®Ÿè¡Œï¼š

```python
def self_check(file_path: str) -> dict:
    """
    ä¿®æ­£å‰ã®è‡ªå·±æ¤œè¨¼
    
    Returns:
        {
            "zone": "Zone 0/1/2A/2B/3",
            "requires_plan": bool,
            "requires_approval": bool,
            "requires_test": bool
        }
    """
    if "layer1" in file_path:
        return {
            "zone": "Zone 0",
            "requires_plan": False,  # ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰ã®ã¿
            "requires_approval": True,
            "requires_test": True,
            "warning": "âš ï¸ Zone 0: ä¿®æ­£ã«ã¯ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰ãŒå¿…è¦"
        }
    # ... ä»¥ä¸‹çœç•¥
```

### Layer 3: äººé–“ã®æœ€çµ‚åˆ¤æ–­

- Zone 0: å¿…é ˆ
- Zone 1: å¿…é ˆ
- Zone 2A: æ¨å¥¨
- Zone 2B: ä»»æ„
- Zone 3: ä¸è¦

---

## ğŸ› ï¸ ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

| ã‚³ãƒãƒ³ãƒ‰ | ç”¨é€” |
|---------|------|
| `/check` | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®Zoneã‚’ç¢ºèª |
| `/plan` | ä¿®æ­£è¨ˆç”»ã‚’æç¤ºï¼ˆZone 1å¿…é ˆï¼‰ |
| `/audit` | ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ |
| `/compact` | ä¼šè©±å±¥æ­´åœ§ç¸® |
| `/clear` | è¨˜æ†¶ãƒªã‚»ãƒƒãƒˆ |

---

## ğŸ›‘ çµ¶å¯¾ç¦æ­¢äº‹é …

### 1. ä¾å­˜æ–¹å‘ã®é€†è»¢

```
âŒ Bad:
UIï¼ˆZone 3ï¼‰ã®éƒ½åˆã§ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆZone 0ï¼‰ã‚’ä¿®æ­£

âœ… Good:
ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆZone 0ï¼‰ã«åˆã‚ã›ã¦UIï¼ˆZone 3ï¼‰ã‚’è¨­è¨ˆ
```

### 2. ãƒ†ã‚¹ãƒˆå‰Šé™¤ãƒ»ç„¡åŠ¹åŒ–

```python
# âŒ Bad
# def test_something():
#     assert False  # å¤±æ•—ã™ã‚‹ã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ

# âœ… Good
def test_something():
    # ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¦ãƒ†ã‚¹ãƒˆã‚’é€šã™
    assert True
```

### 3. å‹æ‰‹ãªæœ€é©åŒ–

```python
# âŒ Bad: Zone 0ã‚’å‹æ‰‹ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿
def calculate_pillars_optimized():  # æœ€é©åŒ–ç‰ˆ
    pass

# âœ… Good: è§¦ã‚‰ãªã„
def calculate_pillars():  # ã‚ªãƒªã‚¸ãƒŠãƒ«ç¶­æŒ
    pass
```

---

## ğŸ“Š Zoneåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè‡ªå‹•ï¼‰

ClaudeãŒè‡ªå‹•ã§åˆ¤å®šï¼š

```python
ZONE_MAP = {
    "src/koyomi/layer1/": "Zone 0",
    "src/koyomi/chat/analyzer.py": "Zone 1",
    "src/koyomi/chat/consultant.py": "Zone 1",
    "src/koyomi/chat/hearing.py": "Zone 2A",
    "app.py": "Zone 2A/2B",  # ãƒ­ã‚¸ãƒƒã‚¯éƒ¨åˆ†=2Aã€UIæ–‡è¨€=2B
    "docs/": "Zone 3",
    "static/": "Zone 3",
    "README.md": "Zone 3",
}
```

---

## ğŸ¯ é–‹ç™ºã®å„ªå…ˆé †ä½

### Phase 1ï¼ˆç¾åœ¨ï¼‰: å®Ÿè£…æœŸ
- Zone 0: å‡çµ âœ…
- Zone 1: æ”¹å–„ä¸­ ğŸ”§
- Zone 2: å®Ÿè£…ä¸­ ğŸ”§
- Zone 3: é«˜é€Ÿåå¾© ğŸš€

### Phase 2ï¼ˆ3ãƒ¶æœˆå¾Œï¼‰: å®‰å®šæœŸ
- Zone 0: ç›£æŸ»å®Ÿæ–½ï¼ˆå¹´æ¬¡ï¼‰
- Zone 1: å®‰å®šåŒ–
- Zone 2: æ©Ÿèƒ½è¿½åŠ 
- Zone 3: UIæ”¹å–„

### Phase 3ï¼ˆ6ãƒ¶æœˆå¾Œï¼‰: æ‹¡å¼µæœŸ
- Layer2ï¼ˆè¥¿æ´‹å æ˜Ÿè¡“ï¼‰è¿½åŠ 
- Zoneå†å®šç¾©
- ç›£æŸ»ãƒ—ãƒ­ã‚»ã‚¹ç¢ºç«‹

---

## ğŸ“ å‚è€ƒè³‡æ–™

- [PRD.md](docs/PRD.md) - è¦ä»¶å®šç¾©
- [.ai-context.md](.ai-context.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ…‹
- [CLAUDE_CODE_WORKFLOW.md](docs/CLAUDE_CODE_WORKFLOW.md) - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- [CONSULTANT_GUIDE.md](docs/CONSULTANT_GUIDE.md) - ä½¿ã„æ–¹

---

## ğŸ”„ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°

- æœˆ1å›: Zoneæ§‹é€ ã®è¦‹ç›´ã—
- å››åŠæœŸ: ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰ã®å®Ÿæ–½
- å¹´1å›: å®Œå…¨ãƒ¬ãƒ“ãƒ¥ãƒ¼

---

**æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ12æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.0 - 4å±¤Zone + ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
